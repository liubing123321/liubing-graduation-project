<%@ page import="org.springframework.context.ApplicationContext" %>
<%@ page import="org.springframework.web.context.support.WebApplicationContextUtils" %>
<%@ page import="com.google.common.collect.Lists" %>
<%@ page import="com.wormpex.bach.affair.man.biz.transfer.TransferOrderBizImpl" %>
<%@ page import="java.util.List" %>
<%@ page import="org.slf4j.LoggerFactory" %>
<%@ page import="org.slf4j.Logger" %>
<%@ page import="com.wormpex.api.json.JsonUtil" %>
<%@ page import="com.wormpex.bach.affair.man.model.vo.pda.AffairUserContext" %>
<%@ page import="com.wormpex.bach.affair.man.model.vo.pda.AffairUserInfo" %>
<%@ page import="org.joda.time.DateTime" %>
<%@ page import="com.wormpex.bach.affair.man.common.util.DateFormatUtil" %>
<%@ page import="java.util.Date" %>

<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>OpenProduct</title>
</head>
<body>

</body>

<%
    try {
        AffairUserInfo affairUserInfo = new AffairUserInfo();
        affairUserInfo.setUserName("cancel.jiaqiang.yan");
        affairUserInfo.setUserRole("");
        affairUserInfo.setMobile("");
        affairUserInfo.setTerminal("");
        affairUserInfo.setUserId("cancel.jiaqiang.yan");
        affairUserInfo.setUserIp("");
        affairUserInfo.setShopInfo(null);
        AffairUserContext.setUserInfo(affairUserInfo);
        Logger logger= LoggerFactory.getLogger(TransferOrderBizImpl.class);
        ApplicationContext applicationContext = WebApplicationContextUtils.getWebApplicationContext(getServletConfig().getServletContext());
        TransferOrderBizImpl transferOrderBiz = applicationContext.getBean(TransferOrderBizImpl.class);

        String param = "49037727804253,49037758059742,49037703718931,49037760468934,49037711212694,49037744743189,49037732449214,49037751659799,49037748723091,49037734082422,49037701316998,49037739132665,49037727335718,49037732478543,49037761489860,49037754049514,49037752919699,49037700000345,49037765634860,49037736897934,49037743704344,49037727058611,49037734006384,49037744325756,49037706449284,49037727188034,49037751706646,49037753584149,49037716923291,49037742473250,49037750947292,49037719857796,49037753212776,49037751149451,49037704769797,49037733081720,49037722748352,49037717810021,49037750319578,49037722767476,49037742896805,49037741161535,49037726595275,49037727428591,49037725786965,49037726470354,49037745385929,49037716352690,49037710703086,49037727765118,49037748931301,49037766333567,49037728398103,49037752648456,49037757267749,49037709271056,49037712801460,49037733643074,49037736701529,49037724584536,49037753183450,49037754482364,49037735715908,49037712567478,49037703884698,49037734588813,49037764650228,49037746833810,49037740526344,49037717598729,49037719223066,49037716760188,49037756316852,49037743791622,49037763334173,49037754608737,49037736490246,49037720158201,49037763858914,49037755122702,49037701898685,49037761215753,49037759896125,49037750147147,49037722626941,49037735955327,49037704651699,49037708588573,49037716192645,49037748602981,49037719965811,49037718597043,49037722796387,49037732171107,49037713579941,49037760937917,49037704288108,49037759899590,49037747239920,49037708805714,49037761013491,49037700839280,49037762076318,49037714729582,49037757342319,49037718332528,49037742846618,49037766951236,49037754135996,49037730976744,49037727977416,49037749489358,49037736371363,49037752792095,49037715635074,49037729561969,49037752356216,49037763352678,49037761363999,49037714398492,49037730637237,49037722381337,49037759246501,49037715455786,49037754805183,49037727248617,49037719366856,49037750335983,49037764100930,49037756996452,49037733634137,49037700131804,49037756156726,49037759857259,49037750524978,49037706224595,49037723724208,49037732915268,49037760260307,49037713889329,49037717575113,49037705600846,49037752266808,49037718528560,49037716860646,49037757851134,49037727032779,49037734671636,49037741671284,49037749568946,49037741889083,49037752036273,49037759097416,49037759232558";
        String params[] = param.split(",");
        String batchNo= DateFormatUtil.parseyyyyMMddHHmmss(new Date());
        for(String key : params){
            try{
                transferOrderBiz.cancel(Lists.newArrayList(Long.valueOf(key)), "GroupWeb");
                logger.info("{} cancel order success param:{}",batchNo, key);
            }catch (Exception e){
                logger.error("{} cancel order fail param:{}", batchNo, key);
            }
        }
    }catch (Exception e){
        e.printStackTrace(response.getWriter());
    }finally {
        response.getWriter().close();
    }
%>

</html>